<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.growdy.web.mapper.ContactMapper">

    <!-- 문의 정보 삽입 -->
    <insert id="insertContactInquiry" parameterType="com.growdy.web.model.ContactForm" useGeneratedKeys="true" keyProperty="inquiryId">
        INSERT INTO contact_inquiry (name, email, phone, subject, message)
        VALUES (#{name}, #{email}, #{phone}, #{subject}, #{message})
    </insert>
    
    <!-- 문의 목록 조회 -->
    <select id="selectAllInquiries" resultType="com.growdy.web.model.ContactInquiry">
        SELECT * FROM contact_inquiry
        ORDER BY created_date DESC
    </select>
    
    <!-- 특정 문의 상세 조회 -->
    <select id="selectInquiryById" parameterType="int" resultType="com.growdy.web.model.ContactInquiry">
        SELECT * FROM contact_inquiry WHERE inquiry_id = #{inquiryId}
    </select>
    
    <!-- 문의 상태 업데이트 -->
    <update id="updateInquiryStatus">
        UPDATE contact_inquiry
        SET status = #{status}, is_read = #{isRead}
        WHERE inquiry_id = #{inquiryId}
    </update>
    
    <!-- 답변 저장 -->
    <insert id="insertReply" parameterType="com.growdy.web.model.ContactReply">
        INSERT INTO contact_reply (inquiry_id, reply_content)
        VALUES (#{inquiryId}, #{replyContent})
    </insert>
    
    <!-- 뉴스레터 구독 등록 -->
    <insert id="insertNewsletterSubscriber" parameterType="string">
        INSERT INTO newsletter_subscriber (email)
        VALUES (#{email})
        ON DUPLICATE KEY UPDATE is_active = TRUE
    </insert>
    
    <!-- 이메일 발송 기록 저장 -->
    <insert id="insertEmailLog" parameterType="com.growdy.web.model.EmailLog">
        INSERT INTO email_log (recipient_email, subject, content, status, error_message)
        VALUES (#{recipientEmail}, #{subject}, #{content}, #{status}, #{errorMessage})
    </insert>
    
</mapper> 